name: Deploy to Laptop Server

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: self-hosted
    
    steps:
    - name: Check out code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: Install Dependencies (Runner)
      run: npm ci

    - name: Build Project
      run: npm run build
      env:
        CI: false

    - name: Publish to Live Site
      run: |
        # 1. Definir la carpeta real
        LIVE_DIR="/home/andy/Documents/GitHub/bluemesito_art_portolio"
        
        # 2. Borrar la carpeta 'build' vieja del sitio real (por limpieza)
        rm -rf "$LIVE_DIR/build"
        
        # 3. Copiar la carpeta 'build' reci√©n creada por el runner al sitio real
        cp -r build "$LIVE_DIR/"
        
        # 4. Reiniciar PM2 para asegurar que sirva los nuevos archivos
        pm2 reload bluemesito
